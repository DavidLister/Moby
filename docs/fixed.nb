(* Content-type: application/mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 7.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       145,          7]
NotebookDataLength[     28037,        721]
NotebookOptionsPosition[     27136,        690]
NotebookOutlinePosition[     27492,        706]
CellTagsIndexPosition[     27449,        703]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"qw1", ",", "qx1", ",", "qy1", ",", 
   RowBox[{
   "qz1", " ", "code", " ", "for", " ", "quaternion", " ", "rotation", " ", 
    "of", " ", "inner", " ", "link", "\[IndentingNewLine]", "qw2"}], ",", " ",
    "qx2", ",", " ", "qy2", ",", " ", 
   RowBox[{
   "qz2", " ", "code", " ", "for", " ", "quaternion", " ", "rotation", " ", 
    "of", " ", "outer", " ", "link", "\[IndentingNewLine]", "x1"}], ",", " ", 
   "y1", ",", " ", 
   RowBox[{"z1", " ", "code", " ", "for", " ", 
    RowBox[{"c", ".", "o", ".", "m", ".", " ", "of"}], " ", "inner", " ", 
    "link", "\[IndentingNewLine]", "x2"}], ",", " ", "y2", ",", " ", 
   RowBox[{"z2", " ", "code", " ", "for", " ", 
    RowBox[{"c", ".", "o", ".", "m", ".", " ", "of"}], " ", "outer", " ", 
    "link", "\[IndentingNewLine]", "qdw1"}], ",", " ", "qdx1", ",", " ", 
   "qdy1", ",", " ", 
   RowBox[{
   "qdz1", " ", "code", " ", "for", " ", "quaternion", " ", "derivative", " ",
     "of", " ", "inner", " ", "link", "\[IndentingNewLine]", "qdw2"}], ",", 
   " ", "qdx2", ",", " ", "qdy2", ",", " ", 
   RowBox[{
   "qdz2", " ", "code", " ", "for", " ", "quaternion", " ", "derivative", " ",
     "of", " ", "outer", " ", "link", "\[IndentingNewLine]", "xd1"}], ",", 
   " ", "yd1", ",", " ", 
   RowBox[{
   "zd1", " ", "code", " ", "for", " ", "linear", " ", "velocity", " ", "of", 
    " ", "inner", " ", "link", "\[IndentingNewLine]", "xd2"}], ",", " ", 
   "yd2", ",", " ", 
   RowBox[{
   "zd2", " ", "code", " ", "for", " ", "linear", " ", "velocity", " ", "of", 
    " ", "outer", " ", "link", "\[IndentingNewLine]", "This", " ", "codes", 
    " ", "for", " ", "a", " ", "3", "x3", " ", "rotation", " ", "matrix", " ",
     "using", " ", "unit", " ", "quaternions"}]}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.516831906785759*^9, 3.516831930417102*^9}, {
  3.516832571276002*^9, 3.5168326011082172`*^9}, {3.516832776597527*^9, 
  3.516832781648965*^9}, {3.5168331511368637`*^9, 3.516833170549831*^9}, {
  3.516836963330677*^9, 3.5168370301602163`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"rx", "[", 
    RowBox[{"qw_", ",", " ", "qx_", ",", " ", "qy_", ",", " ", "qz_"}], "]"}],
    " ", ":=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"2", "*", "qx", "*", "qx"}], " ", "+", " ", 
      RowBox[{"2", "*", "qw", "*", "qw"}], " ", "-", "1"}], ",", " ", 
     RowBox[{"2", "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"qx", "*", "qy"}], " ", "-", " ", 
        RowBox[{"qz", "*", "qw"}]}], ")"}]}], ",", " ", 
     RowBox[{"2", "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"qx", "*", "qz"}], " ", "+", " ", 
        RowBox[{"qy", "*", "qw"}]}], ")"}]}]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{
  3.5168326120556927`*^9, {3.520879084702777*^9, 3.520879096345265*^9}, {
   3.520879462347087*^9, 3.520879462431052*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ry", "[", 
    RowBox[{"qw_", ",", " ", "qx_", ",", " ", "qy_", ",", " ", "qz_"}], "]"}],
    " ", ":=", "  ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"2", "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"qx", "*", "qy"}], " ", "+", " ", 
        RowBox[{"qz", "*", "qw"}]}], ")"}]}], ",", " ", 
     RowBox[{
      RowBox[{"2", "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"qy", "*", "qy"}], " ", "+", " ", 
         RowBox[{"qw", "*", "qw"}]}], ")"}]}], " ", "-", " ", "1"}], ",", " ", 
     RowBox[{"2", "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"qy", "*", "qz"}], " ", "-", " ", 
        RowBox[{"qx", "*", "qw"}]}], ")"}]}]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.520879041659081*^9, 3.520879062968046*^9}, {
  3.5208794605108833`*^9, 3.520879460820671*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"rz", "[", 
    RowBox[{"qw_", ",", " ", "qx_", ",", " ", "qy_", ",", " ", "qz_"}], "]"}],
    " ", ":=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"2", "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"qx", "*", "qz"}], " ", "-", " ", 
        RowBox[{"qy", "*", "qw"}]}], ")"}]}], ",", " ", 
     RowBox[{"2", "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"qy", "*", "qz"}], " ", "+", " ", 
        RowBox[{"qx", "*", "qw"}]}], ")"}]}], ",", " ", 
     RowBox[{
      RowBox[{"2", "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"qz", "*", "qz"}], " ", "+", " ", 
         RowBox[{"qw", "*", "qw"}]}], ")"}]}], " ", "-", " ", "1"}]}], 
    "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.520879074134499*^9, 3.520879080733307*^9}, {
  3.52087945851375*^9, 3.520879458578888*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Rx", "[", 
   RowBox[{"qw_", ",", " ", "qx_", ",", " ", "qy_", ",", " ", "qz_"}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"rx", "[", 
     RowBox[{"qw", ",", " ", "qx", ",", " ", "qy", ",", " ", "qz"}], "]"}], 
    ",", " ", 
    RowBox[{"ry", "[", 
     RowBox[{"qw", ",", " ", "qx", ",", " ", "qy", ",", " ", "qz"}], "]"}], 
    ",", " ", 
    RowBox[{"rz", "[", 
     RowBox[{"qw", ",", " ", "qx", ",", " ", "qy", ",", " ", "qz"}], "]"}]}], 
   "}"}]}]], "Input",
 CellChangeTimes->{{3.520879064918459*^9, 3.520879065581416*^9}, {
  3.520879488998732*^9, 3.520879530415895*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "This", " ", "is", " ", "the", " ", "generalized", " ", "velocity", " ", 
    "vector"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"qd", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", "xd1", "}"}], ",", " ", 
      RowBox[{"{", "yd1", "}"}], ",", " ", 
      RowBox[{"{", "zd1", "}"}], ",", " ", 
      RowBox[{"{", "qdw1", "}"}], ",", " ", 
      RowBox[{"{", "qdx1", "}"}], ",", " ", 
      RowBox[{"{", "qdy1", "}"}], ",", " ", 
      RowBox[{"{", "qdz1", "}"}], ",", " ", 
      RowBox[{"{", "xd2", "}"}], ",", " ", 
      RowBox[{"{", "yd2", "}"}], ",", " ", 
      RowBox[{"{", "zd2", "}"}], ",", " ", 
      RowBox[{"{", "qdw2", "}"}], ",", " ", 
      RowBox[{"{", "qdx2", "}"}], ",", " ", 
      RowBox[{"{", "qdy2", "}"}], ",", " ", 
      RowBox[{"{", "qdz2", "}"}]}], "}"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.5168319661038446`*^9, 3.5168319699662523`*^9}, {
  3.51683225758799*^9, 3.516832263718032*^9}, {3.516832770815384*^9, 
  3.516832773697507*^9}, {3.516837038511464*^9, 3.51683709264262*^9}, {
  3.5208794535466623`*^9, 3.52087945452763*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "These", " ", "are", " ", "the", " ", "attachment", " ", "points", " ", 
     "for", " ", "the", " ", "joint", " ", "local", " ", "to", " ", "inner", 
     " ", "and", " ", "outer", " ", "links"}], ",", " ", "respectively"}], 
   " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"p1", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "p1x", "}"}], ",", " ", 
       RowBox[{"{", "p1y", "}"}], ",", " ", 
       RowBox[{"{", "p1z", "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"p2", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "p2x", "}"}], ",", " ", 
       RowBox[{"{", "p2y", "}"}], ",", " ", 
       RowBox[{"{", "p2z", "}"}]}], "}"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.516832859379567*^9, 3.516832936756996*^9}, {
   3.516833047297482*^9, 3.516833116410542*^9}, {3.516833256643174*^9, 
   3.516833299656583*^9}, {3.516838115354039*^9, 3.516838135020554*^9}, {
   3.516838421773135*^9, 3.516838436428732*^9}, 3.520879417438081*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "This", " ", "is", " ", "the", " ", "global", " ", "attachment", " ", 
    "point", " ", "of", " ", "the", " ", "joint"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"r12", " ", "=", " ", 
    RowBox[{
     RowBox[{"Transpose", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Rx", "[", 
         RowBox[{
          RowBox[{"qw1", "[", "t", "]"}], ",", " ", 
          RowBox[{"qx1", "[", "t", "]"}], ",", " ", 
          RowBox[{"qy1", "[", "t", "]"}], ",", " ", 
          RowBox[{"qz1", "[", "t", "]"}]}], "]"}], " ", ".", " ", "p1"}], " ",
        "+", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x1", "[", "t", "]"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"y1", "[", "t", "]"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"z1", "[", "t", "]"}], "}"}]}], "}"}], "  ", "-", " ", 
       RowBox[{
        RowBox[{"Rx", "[", 
         RowBox[{
          RowBox[{"qw2", "[", "t", "]"}], ",", " ", 
          RowBox[{"qx2", "[", "t", "]"}], ",", " ", 
          RowBox[{"qy2", "[", "t", "]"}], ",", " ", 
          RowBox[{"qz2", "[", "t", "]"}]}], "]"}], ".", "p2"}], " ", "-", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x2", "[", "t", "]"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"y2", "[", "t", "]"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"z2", "[", "t", "]"}], "}"}]}], "}"}]}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.5168329903427563`*^9, 3.516833042981676*^9}, {
   3.516833138896289*^9, 3.516833141796113*^9}, {3.516833175859683*^9, 
   3.5168332254717007`*^9}, 3.516835683161337*^9, {3.520880079385641*^9, 
   3.5208800838683567`*^9}, {3.520880187040003*^9, 3.520880205560614*^9}, {
   3.520880246793209*^9, 3.5208802518903627`*^9}, {3.530835202415517*^9, 
   3.530835242219652*^9}, 3.530835350613452*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "These", " ", "are", " ", "the", " ", "constraint", " ", "equations"}], 
   " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Ceq", " ", "=", " ", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"r12", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", 
      RowBox[{"r12", "[", 
       RowBox[{"[", "2", "]"}], "]"}], ",", 
      RowBox[{"r12", "[", 
       RowBox[{"[", "3", "]"}], "]"}], ",", 
      RowBox[{"Dot", "[", 
       RowBox[{
        RowBox[{"rx", "[", 
         RowBox[{
          RowBox[{"qw1", "[", "t", "]"}], ",", " ", 
          RowBox[{"qx1", "[", "t", "]"}], ",", " ", 
          RowBox[{"qy1", "[", "t", "]"}], ",", " ", 
          RowBox[{"qz1", "[", "t", "]"}]}], "]"}], ",", " ", 
        RowBox[{"rx", "[", 
         RowBox[{
          RowBox[{"qw2", "[", "t", "]"}], ",", " ", 
          RowBox[{"qx2", "[", "t", "]"}], ",", " ", 
          RowBox[{"qy2", "[", "t", "]"}], ",", " ", 
          RowBox[{"qz2", "[", "t", "]"}]}], "]"}]}], "]"}], ",", " ", 
      RowBox[{"Dot", "[", 
       RowBox[{
        RowBox[{"ry", "[", 
         RowBox[{
          RowBox[{"qw1", "[", "t", "]"}], ",", " ", 
          RowBox[{"qx1", "[", "t", "]"}], ",", " ", 
          RowBox[{"qy1", "[", "t", "]"}], ",", " ", 
          RowBox[{"qz1", "[", "t", "]"}]}], "]"}], ",", " ", 
        RowBox[{"ry", "[", 
         RowBox[{
          RowBox[{"qw2", "[", "t", "]"}], ",", " ", 
          RowBox[{"qx2", "[", "t", "]"}], ",", " ", 
          RowBox[{"qy2", "[", "t", "]"}], ",", " ", 
          RowBox[{"qz2", "[", "t", "]"}]}], "]"}]}], "]"}], ",", " ", 
      RowBox[{"Dot", "[", 
       RowBox[{
        RowBox[{"rz", "[", 
         RowBox[{
          RowBox[{"qw1", "[", "t", "]"}], ",", " ", 
          RowBox[{"qx1", "[", "t", "]"}], ",", " ", 
          RowBox[{"qy1", "[", "t", "]"}], ",", " ", 
          RowBox[{"qz1", "[", "t", "]"}]}], "]"}], ",", 
        RowBox[{"rz", "[", 
         RowBox[{
          RowBox[{"qw2", "[", "t", "]"}], ",", " ", 
          RowBox[{"qx2", "[", "t", "]"}], ",", " ", 
          RowBox[{"qy2", "[", "t", "]"}], ",", " ", 
          RowBox[{"qz2", "[", "t", "]"}]}], "]"}]}], "]"}]}], "}"}]}], 
   ";"}]}]], "Input",
 CellChangeTimes->{{3.51683337952949*^9, 3.516833550534486*^9}, {
  3.516834002212858*^9, 3.516834008879223*^9}, {3.520879162964238*^9, 
  3.5208791987766523`*^9}, {3.520879229791903*^9, 3.520879342899729*^9}, {
  3.5208793816636057`*^9, 3.5208794095636587`*^9}, {3.520879722050222*^9, 
  3.520879772766138*^9}, {3.520880150896738*^9, 3.520880156645876*^9}, {
  3.53083526194141*^9, 3.530835339523569*^9}}],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Constraint", " ", "Jacobian"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.5168335748855124`*^9, 3.5168335857750883`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Cq", " ", "=", " ", 
   RowBox[{
    RowBox[{"Transpose", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"D", "[", 
        RowBox[{"Ceq", ",", " ", 
         RowBox[{"x1", "[", "t", "]"}]}], "]"}], ",", " ", 
       RowBox[{"D", "[", 
        RowBox[{"Ceq", ",", " ", 
         RowBox[{"y1", "[", "t", "]"}]}], "]"}], ",", " ", 
       RowBox[{"D", "[", 
        RowBox[{"Ceq", ",", " ", 
         RowBox[{"z1", "[", "t", "]"}]}], "]"}], ",", " ", 
       RowBox[{"D", "[", 
        RowBox[{"Ceq", ",", " ", 
         RowBox[{"qw1", "[", "t", "]"}]}], "]"}], ",", " ", 
       RowBox[{"D", "[", 
        RowBox[{"Ceq", ",", " ", 
         RowBox[{"qx1", "[", "t", "]"}]}], "]"}], ",", " ", 
       RowBox[{"D", "[", 
        RowBox[{"Ceq", ",", " ", 
         RowBox[{"qy1", "[", "t", "]"}]}], "]"}], ",", " ", 
       RowBox[{"D", "[", 
        RowBox[{"Ceq", ",", " ", 
         RowBox[{"qz1", "[", "t", "]"}]}], "]"}], ",", " ", 
       RowBox[{"D", "[", 
        RowBox[{"Ceq", ",", " ", 
         RowBox[{"x2", "[", "t", "]"}]}], "]"}], ",", " ", 
       RowBox[{"D", "[", 
        RowBox[{"Ceq", ",", " ", 
         RowBox[{"y2", "[", "t", "]"}]}], "]"}], ",", " ", 
       RowBox[{"D", "[", 
        RowBox[{"Ceq", ",", " ", 
         RowBox[{"z2", "[", "t", "]"}]}], "]"}], ",", " ", 
       RowBox[{"D", "[", 
        RowBox[{"Ceq", ",", " ", 
         RowBox[{"qw2", "[", "t", "]"}]}], "]"}], ",", " ", 
       RowBox[{"D", "[", 
        RowBox[{"Ceq", ",", " ", 
         RowBox[{"qx2", "[", "t", "]"}]}], "]"}], ",", " ", 
       RowBox[{"D", "[", 
        RowBox[{"Ceq", ",", " ", 
         RowBox[{"qy2", "[", "t", "]"}]}], "]"}], ",", " ", 
       RowBox[{"D", "[", 
        RowBox[{"Ceq", ",", " ", 
         RowBox[{"qz2", "[", "t", "]"}]}], "]"}]}], "}"}], "]"}], "/.", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"x1", "[", "t", "]"}], " ", "\[Rule]", " ", "x1"}], ",", " ", 
      RowBox[{
       RowBox[{"y1", "[", "t", "]"}], " ", "\[Rule]", " ", "y1"}], ",", " ", 
      RowBox[{
       RowBox[{"z1", "[", "t", "]"}], " ", "\[Rule]", " ", "z1"}], ",", " ", 
      RowBox[{
       RowBox[{"qx1", "[", "t", "]"}], " ", "\[Rule]", " ", "qx1"}], ",", " ", 
      RowBox[{
       RowBox[{"qy1", "[", "t", "]"}], " ", "\[Rule]", " ", "qy1"}], ",", " ", 
      RowBox[{
       RowBox[{"qz1", "[", "t", "]"}], " ", "\[Rule]", " ", "qz1"}], ",", " ", 
      RowBox[{
       RowBox[{"qw1", "[", "t", "]"}], " ", "\[Rule]", " ", "qw1"}], ",", " ", 
      RowBox[{
       RowBox[{"x2", "[", "t", "]"}], " ", "\[Rule]", " ", "x2"}], ",", " ", 
      RowBox[{
       RowBox[{"y2", "[", "t", "]"}], " ", "\[Rule]", " ", "y2"}], ",", " ", 
      RowBox[{
       RowBox[{"z2", "[", "t", "]"}], " ", "\[Rule]", " ", "z2"}], ",", " ", 
      RowBox[{
       RowBox[{"qx2", "[", "t", "]"}], " ", "\[Rule]", " ", "qx2"}], ",", " ", 
      RowBox[{
       RowBox[{"qy2", "[", "t", "]"}], " ", "\[Rule]", " ", "qy2"}], ",", " ", 
      RowBox[{
       RowBox[{"qz2", "[", "t", "]"}], " ", "\[Rule]", " ", "qz2"}], ",", " ", 
      RowBox[{
       RowBox[{"qw2", "[", "t", "]"}], " ", "\[Rule]", " ", "qw2"}]}], 
     "}"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.516833589266156*^9, 3.516833672944972*^9}, {
  3.516833715763916*^9, 3.516833821574267*^9}, {3.516834049007729*^9, 
  3.5168340532540283`*^9}, {3.530835387725222*^9, 3.530835426251287*^9}, {
  3.530838774691893*^9, 3.530838796439073*^9}}],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
  "time", " ", "derivative", " ", "of", " ", "the", " ", "Constraint", " ", 
   "Jacobian"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.530835471549736*^9, 3.530835477809445*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Cqdot", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"Ceq", ",", " ", 
            RowBox[{"x1", "[", "t", "]"}]}], "]"}], ",", " ", "t"}], "]"}], 
        ",", " ", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"Ceq", ",", " ", 
            RowBox[{"y1", "[", "t", "]"}]}], "]"}], ",", " ", "t"}], "]"}], 
        ",", " ", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"Ceq", ",", " ", 
            RowBox[{"z1", "[", "t", "]"}]}], "]"}], ",", " ", "t"}], "]"}], 
        ",", " ", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"Ceq", ",", " ", 
            RowBox[{"qw1", "[", "t", "]"}]}], "]"}], ",", " ", "t"}], "]"}], 
        ",", " ", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"Ceq", ",", " ", 
            RowBox[{"qx1", "[", "t", "]"}]}], "]"}], ",", " ", "t"}], "]"}], 
        ",", " ", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"Ceq", ",", " ", 
            RowBox[{"qy1", "[", "t", "]"}]}], "]"}], ",", " ", "t"}], "]"}], 
        ",", " ", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"Ceq", ",", " ", 
            RowBox[{"qz1", "[", "t", "]"}]}], "]"}], ",", " ", "t"}], "]"}], 
        ",", " ", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"Ceq", ",", " ", 
            RowBox[{"x2", "[", "t", "]"}]}], "]"}], ",", " ", "t"}], "]"}], 
        ",", " ", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"Ceq", ",", " ", 
            RowBox[{"y2", "[", "t", "]"}]}], "]"}], ",", " ", "t"}], "]"}], 
        ",", " ", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"Ceq", ",", " ", 
            RowBox[{"z2", "[", "t", "]"}]}], "]"}], ",", " ", "t"}], "]"}], 
        ",", " ", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"Ceq", ",", " ", 
            RowBox[{"qw2", "[", "t", "]"}]}], "]"}], ",", " ", "t"}], "]"}], 
        ",", " ", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"Ceq", ",", " ", 
            RowBox[{"qx2", "[", "t", "]"}]}], "]"}], ",", " ", "t"}], "]"}], 
        ",", 
        RowBox[{"D", "[", " ", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"Ceq", ",", " ", 
            RowBox[{"qy2", "[", "t", "]"}]}], "]"}], ",", " ", "t"}], "]"}], 
        ",", " ", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"Ceq", ",", " ", 
            RowBox[{"qz2", "[", "t", "]"}]}], "]"}], ",", " ", "t"}], "]"}]}],
        "}"}], "]"}], " ", "/.", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"x1", "[", "t", "]"}], ",", " ", "t"}], "]"}], " ", 
        "\[Rule]", " ", "dx1"}], ",", " ", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"y1", "[", "t", "]"}], ",", " ", "t"}], "]"}], " ", 
        "\[Rule]", " ", "dy1"}], ",", " ", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"z1", "[", "t", "]"}], ",", " ", "t"}], "]"}], " ", 
        "\[Rule]", " ", "dz1"}], ",", " ", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"qx1", "[", "t", "]"}], ",", " ", "t"}], "]"}], " ", 
        "\[Rule]", " ", "dqx1"}], ",", " ", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"qy1", "[", "t", "]"}], ",", " ", "t"}], "]"}], " ", 
        "\[Rule]", " ", "dqy1"}], ",", " ", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"qz1", "[", "t", "]"}], ",", " ", "t"}], "]"}], " ", 
        "\[Rule]", " ", "dqz1"}], ",", " ", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"qw1", "[", "t", "]"}], ",", " ", "t"}], "]"}], " ", 
        "\[Rule]", " ", "dqw1"}], ",", " ", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"x2", "[", "t", "]"}], ",", " ", "t"}], "]"}], " ", 
        "\[Rule]", " ", "dx2"}], ",", " ", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"y2", "[", "t", "]"}], ",", " ", "t"}], "]"}], " ", 
        "\[Rule]", " ", "dy2"}], ",", " ", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"z2", "[", "t", "]"}], ",", " ", "t"}], "]"}], " ", 
        "\[Rule]", " ", "dz2"}], ",", " ", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"qx2", "[", "t", "]"}], ",", " ", "t"}], "]"}], " ", 
        "\[Rule]", " ", "dqx2"}], ",", " ", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"qy2", "[", "t", "]"}], ",", " ", "t"}], "]"}], " ", 
        "\[Rule]", " ", "dqy2"}], ",", " ", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"qz2", "[", "t", "]"}], ",", " ", "t"}], "]"}], " ", 
        "\[Rule]", " ", "dqz2"}], ",", " ", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"qw2", "[", "t", "]"}], ",", " ", "t"}], "]"}], " ", 
        "\[Rule]", " ", "dqw2"}]}], "}"}]}], " ", "/.", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"x1", "[", "t", "]"}], " ", "\[Rule]", " ", "x1"}], ",", " ", 
      RowBox[{
       RowBox[{"y1", "[", "t", "]"}], " ", "\[Rule]", " ", "y1"}], ",", " ", 
      RowBox[{
       RowBox[{"z1", "[", "t", "]"}], " ", "\[Rule]", " ", "z1"}], ",", " ", 
      RowBox[{
       RowBox[{"qx1", "[", "t", "]"}], " ", "\[Rule]", " ", "qx1"}], ",", " ", 
      RowBox[{
       RowBox[{"qy1", "[", "t", "]"}], " ", "\[Rule]", " ", "qy1"}], ",", " ", 
      RowBox[{
       RowBox[{"qz1", "[", "t", "]"}], " ", "\[Rule]", " ", "qz1"}], ",", " ", 
      RowBox[{
       RowBox[{"qw1", "[", "t", "]"}], " ", "\[Rule]", " ", "qw1"}], ",", " ", 
      RowBox[{
       RowBox[{"x2", "[", "t", "]"}], " ", "\[Rule]", " ", "x2"}], ",", " ", 
      RowBox[{
       RowBox[{"y2", "[", "t", "]"}], " ", "\[Rule]", " ", "y2"}], ",", " ", 
      RowBox[{
       RowBox[{"z2", "[", "t", "]"}], " ", "\[Rule]", " ", "z2"}], ",", " ", 
      RowBox[{
       RowBox[{"qx2", "[", "t", "]"}], " ", "\[Rule]", " ", "qx2"}], ",", " ", 
      RowBox[{
       RowBox[{"qy2", "[", "t", "]"}], " ", "\[Rule]", " ", "qy2"}], ",", " ", 
      RowBox[{
       RowBox[{"qz2", "[", "t", "]"}], " ", "\[Rule]", " ", "qz2"}], ",", " ", 
      RowBox[{
       RowBox[{"qw2", "[", "t", "]"}], " ", "\[Rule]", " ", "qw2"}]}], 
     "}"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.53083549113265*^9, 3.530835681427475*^9}, {
  3.5308369254844303`*^9, 3.53083700032483*^9}, {3.530837215116232*^9, 
  3.53083742252215*^9}, {3.530837462012327*^9, 3.530837568842852*^9}}],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
  "The", " ", "constraint", " ", "Jacobian", " ", "in", " ", "all", " ", 
   RowBox[{"its", " ", "'"}], 
   RowBox[{"C", "'"}], " ", "glory"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.516834075243998*^9, 3.516834094054775*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"CForm", "[", 
  RowBox[{
   RowBox[{"Cqdot", "[", 
    RowBox[{"[", "6", "]"}], "]"}], "[", 
   RowBox[{"[", "11", "]"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.516833675447134*^9, 3.5168336952801447`*^9}, 
   3.516833761986804*^9, {3.516833832472921*^9, 3.516833970587474*^9}, {
   3.5168340215698338`*^9, 3.5168340231075*^9}, {3.516834062367535*^9, 
   3.516834064041087*^9}, {3.516834444969276*^9, 3.516834473634577*^9}, {
   3.516834638105349*^9, 3.5168346915613337`*^9}, {3.516834936903421*^9, 
   3.516835015572612*^9}, {3.5168350504169407`*^9, 3.516835118117544*^9}, {
   3.516835151656684*^9, 3.5168352298732653`*^9}, {3.516835360113474*^9, 
   3.51683548229443*^9}, {3.516835713617016*^9, 3.516835789378467*^9}, {
   3.516835825570979*^9, 3.5168358256621513`*^9}, {3.516835869835969*^9, 
   3.516835869905056*^9}, {3.5168359390694427`*^9, 3.516836443779736*^9}, {
   3.516837111662462*^9, 3.516837144322873*^9}, {3.5208824682221107`*^9, 
   3.520882515326898*^9}, {3.520882578253509*^9, 3.520882583999905*^9}, {
   3.5208828596507*^9, 3.520882859844831*^9}, {3.520882987421206*^9, 
   3.5208829875463257`*^9}, {3.520883058356769*^9, 3.520883058476408*^9}, {
   3.520883170500128*^9, 3.52088317065095*^9}, {3.5208832691752653`*^9, 
   3.5208832694648952`*^9}, {3.53083538319561*^9, 3.53083538335524*^9}, {
   3.530835687260806*^9, 3.5308356882438726`*^9}, {3.530835720731064*^9, 
   3.5308357319310703`*^9}, {3.530835930069438*^9, 3.530835930237314*^9}, {
   3.530836167829052*^9, 3.530836174324603*^9}, {3.5308362395819197`*^9, 
   3.530836242157403*^9}, {3.530837622826996*^9, 3.530837646967204*^9}, {
   3.530837711942073*^9, 3.530837781979932*^9}, {3.5308378202409286`*^9, 
   3.5308378941339273`*^9}, {3.5308380492898607`*^9, 3.530838439138484*^9}}],

Cell["\<\
-4*qy2*(-(dqy1*qw1) + dqz1*qx1 - dqw1*qy1 + dqx1*qz1) + 
   4*qx2*(dqx1*qw1 + dqw1*qx1 + dqz1*qy1 + dqy1*qz1) + 
   8*qw2*(2*dqw1*qw1 + 2*dqz1*qz1) - 4*dqy2*(-(qw1*qy1) + qx1*qz1) + 
   4*dqx2*(qw1*qx1 + qy1*qz1) + 
   4*dqw2*(-1 + 2*(Power(qw1,2) + Power(qz1,2)))\
\>", "Output",
 CellChangeTimes->{{3.5208824704892063`*^9, 3.5208825158548727`*^9}, 
   3.520882585804484*^9, 3.520882860331397*^9, 3.5208829880713987`*^9, 
   3.5208830589081182`*^9, 3.520883171089213*^9, 3.520883269999424*^9, 
   3.530834698064921*^9, {3.5308353676775427`*^9, 3.530835383878216*^9}, 
   3.530835429942131*^9, 3.530835689129332*^9, {3.530835722563531*^9, 
   3.530835732819659*^9}, 3.530835930651896*^9, {3.530836168591722*^9, 
   3.5308361746883583`*^9}, 3.530836243030765*^9, {3.530836983837132*^9, 
   3.530837004181087*^9}, 3.530837238843051*^9, 3.5308374268607597`*^9, 
   3.5308375726697063`*^9, {3.5308376241111507`*^9, 3.530837647693651*^9}, {
   3.530837729669739*^9, 3.530837782915628*^9}, {3.5308378367967253`*^9, 
   3.530837895017232*^9}, {3.530838073843227*^9, 3.530838106315509*^9}, {
   3.5308381385179234`*^9, 3.5308384402765827`*^9}}]
}, Open  ]]
},
WindowSize->{640, 750},
WindowMargins->{{146, Automatic}, {0, Automatic}},
FrontEndVersion->"8.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (November 6, \
2010)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[545, 20, 2066, 38, 148, "Input"],
Cell[2614, 60, 827, 23, 43, "Input"],
Cell[3444, 85, 867, 25, 43, "Input"],
Cell[4314, 112, 868, 26, 43, "Input"],
Cell[5185, 140, 643, 17, 43, "Input"],
Cell[5831, 159, 1168, 27, 58, "Input"],
Cell[7002, 188, 1118, 27, 73, "Input"],
Cell[8123, 217, 2016, 49, 88, "Input"],
Cell[10142, 268, 2654, 64, 133, "Input"],
Cell[12799, 334, 170, 3, 27, "Input"],
Cell[12972, 339, 3473, 83, 133, "Input"],
Cell[16448, 424, 228, 5, 27, "Input"],
Cell[16679, 431, 7193, 197, 238, "Input"],
Cell[23875, 630, 278, 6, 27, "Input"],
Cell[CellGroupData[{
Cell[24178, 640, 1793, 27, 27, "Input"],
Cell[25974, 669, 1146, 18, 91, "Output"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
